<% title = title || 'Mi cuenta' %>
<div class="space-y-6">
  <% if (flash && flash.ok) { %>
    <div class="alert alert-success shadow">
      <span><%= flash.ok %></span>
    </div>
  <% } %>
  <% if (flash && flash.error) { %>
    <div class="alert alert-error shadow">
      <span><%= flash.error %></span>
    </div>
  <% } %>
  <% if (mustChange) { %>
    <div class="alert alert-warning shadow">
      <span>Debes actualizar tu contraseña antes de continuar utilizando el sistema.</span>
    </div>
  <% } %>
  <% if (typeof passwordDaysRemaining === 'number' && passwordDaysRemaining > 0 && passwordDaysRemaining <= 15) { %>
    <div class="alert alert-info shadow">
      <span>Tu contraseña vence en <strong><%= passwordDaysRemaining %></strong> día(s). Actualízala cuanto antes.</span>
    </div>
  <% } %>
  <div class="card border border-base-300/40 bg-base-200/60">
    <div class="card-body">
      <h2 class="card-title">Perfil</h2>
      <form action="/cuenta/update-profile" method="post" class="grid gap-4 sm:grid-cols-2">
        <label class="form-control">
          <span class="label-text">Nombre</span>
          <input class="input input-bordered" type="text" name="nombre" value="<%= (accountUser && accountUser.nombre) || '' %>" required />
        </label>
        <label class="form-control">
          <span class="label-text">Correo</span>
          <input class="input input-bordered" type="email" name="correo" value="<%= (accountUser && accountUser.correo) || '' %>" required />
        </label>
        <label class="form-control">
          <span class="label-text">Teléfono</span>
          <input class="input input-bordered" type="text" name="telefono" value="<%= (accountUser && accountUser.telefono) || '' %>" />
        </label>
        <label class="form-control">
          <span class="label-text">Sede asignada</span>
          <input class="input input-bordered" type="text" value="<%= accountUser ? (accountUser.sede_nombre || (accountUser.sede_id ? ('ID '+accountUser.sede_id) : 'Sin sede')) : '' %>" readonly />
        </label>
        <div class="sm:col-span-2">
          <button class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card border border-base-300/40 bg-base-200/60">
    <div class="card-body">
      <h2 class="card-title">Cambiar contraseña</h2>
      <p class="text-sm opacity-80 mb-2"><%= passwordPolicy %></p>
      <form action="/cuenta/change-password" method="post" class="grid gap-4 sm:grid-cols-2" autocomplete="off">
        <label class="form-control">
          <span class="label-text">Actual</span>
          <div class="flex items-center gap-2">
            <input id="account-current-password" class="input input-bordered flex-1" type="password" name="current_password" autocomplete="off" onpaste="return false" ondrop="return false" required />
            <button type="button" class="btn btn-xs btn-outline btn-circle" data-password-toggle="account-current-password" aria-label="Mostrar u ocultar contraseña" aria-pressed="false"><span class="inline-flex h-4 w-4 items-center justify-center" data-eye-icon></span></button>
          </div>
        </label>
        <label class="form-control">
          <span class="label-text">Nueva</span>
          <div class="flex items-center gap-2">
            <input id="account-new-password" class="input input-bordered flex-1" type="password" name="new_password" minlength="8" autocomplete="off" onpaste="return false" ondrop="return false" required />
            <button type="button" class="btn btn-xs btn-outline btn-circle" data-password-toggle="account-new-password" aria-label="Mostrar u ocultar contraseña" aria-pressed="false"><span class="inline-flex h-4 w-4 items-center justify-center" data-eye-icon></span></button>
          </div>
        </label>
        <label class="form-control">
          <span class="label-text">Confirmar nueva contraseña</span>
          <div class="flex items-center gap-2">
            <input id="account-confirm-password" class="input input-bordered flex-1" type="password" name="confirm_password" minlength="8" autocomplete="off" onpaste="return false" ondrop="return false" required />
            <button type="button" class="btn btn-xs btn-outline btn-circle" data-password-toggle="account-confirm-password" aria-label="Mostrar u ocultar contraseña" aria-pressed="false"><span class="inline-flex h-4 w-4 items-center justify-center" data-eye-icon></span></button>
          </div>
        </label>
        <div class="sm:col-span-2">
          <button class="btn btn-primary">Actualizar contraseña</button>
        </div>
      </form>
      <div class="mt-4 text-xs opacity-70">
        <p>Tiempo de sesión asignado: <strong><%= accountUser ? accountUser.sesion_ttl_minutos : '-' %> min</strong> (rangos permitidos: <%= sessionTtlMin %> - <%= sessionTtlMax %> min).</p>
        <% if (passwordExpiresAt) { %>
          <p>Próximo vencimiento de contraseña: <strong><%= passwordExpiresAt.toLocaleString('es-CO') %></strong>.</p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script src="/static/js/password-visibility.js?v=<%= assetVersion %>" defer></script>

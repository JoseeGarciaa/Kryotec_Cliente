<% title = title || 'Operación · Devolución' %>
<div class="mb-8">
  <h1 class="text-2xl font-bold mb-6">Devolución</h1>
  <div class="grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2 rounded-xl border border-base-300/50 bg-base-200/5 p-5">
      <div class="flex items-center gap-2 mb-4">
        <span id="dev-spin" class="loading loading-spinner loading-xs hidden"></span>
        <span class="text-sm opacity-60">Listado de cajas activas. Usa el botón ↩ para devolver la caja completa a Bodega.</span>
      </div>
      <div id="dev-caja-grid" class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"></div>
    </div>
    <div class="rounded-xl border border-base-300/50 bg-base-200/5 p-5 flex flex-col gap-4">
      <h2 class="text-sm font-semibold tracking-wide uppercase opacity-80">Identificar Caja</h2>
      <div class="form-control">
        <label class="label py-1"><span class="label-text text-xs opacity-70">Escanea un RFID (24 caracteres)</span></label>
        <input id="dev-scan" type="text" maxlength="24" class="input input-sm input-bordered font-mono" placeholder="RFID 24" autocomplete="off" />
      </div>
      <div class="flex gap-2">
        <button id="dev-scan-btn" class="btn btn-sm btn-primary flex-1">Buscar</button>
        <button id="dev-scan-clear" class="btn btn-sm">Limpiar</button>
      </div>
      <div id="dev-scan-msg" class="text-xs min-h-[18px] font-mono opacity-80"></div>
      <div id="dev-scan-result" class="space-y-3 hidden">
        <div class="text-xs opacity-60 uppercase tracking-wide">Caja detectada</div>
        <div class="border rounded-lg p-3 bg-base-300/10 space-y-2" id="dev-scan-card"></div>
        <div class="text-[10px] opacity-50" id="dev-scan-extra"></div>
      </div>
    </div>
  </div>
</div>
<!-- Modal Detalle Caja -->
<dialog id="dev-modal" class="modal">
  <div class="modal-box max-w-sm p-5 space-y-4">
    <h3 class="font-semibold text-sm" id="dev-modal-title">Caja</h3>
    <div id="dev-modal-body" class="space-y-3 text-xs"></div>
    <div class="flex gap-2 pt-2">
      <button id="dev-modal-return" class="btn btn-error btn-sm flex-1">↩ Devolver a Bodega</button>
      <button id="dev-modal-close" class="btn btn-sm">Cerrar</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>Cerrar</button>
  </form>
</dialog>
<!-- Confirmar devolución -->
<dialog id="dev-confirm" class="modal">
  <div class="modal-box max-w-xs p-5 space-y-4">
    <h3 class="font-semibold text-sm">Confirmar devolución</h3>
    <p id="dev-confirm-msg" class="text-xs opacity-80">¿Devolver caja a Bodega?</p>
    <div class="flex gap-2 pt-2">
      <button id="dev-confirm-yes" class="btn btn-error btn-sm flex-1">Sí, devolver</button>
      <button id="dev-confirm-no" class="btn btn-sm flex-1">Cancelar</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>Cancelar</button>
  </form>
</dialog>
<script src="/static/js/devolucion.js?v=<%= assetVersion %>" defer></script>

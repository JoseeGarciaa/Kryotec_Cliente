<% title = title || 'Operación · Devolución' %>
<div class="mb-8">
  <h1 class="text-2xl font-bold mb-4">Gestión de Devolución</h1>
  <hr class="mb-6" />

  <!-- Proceso explicativo -->
  <div class="rounded-xl border border-info/30 bg-info/5 p-5 mb-8">
    <h2 class="font-semibold mb-2 text-info-content/90">Proceso de Devolución</h2>
    <ol class="list-decimal list-inside text-sm space-y-1 opacity-80">
      <li>Los items completados en operación aparecen automáticamente como pendientes de devolución</li>
      <li>Separar físicamente los Cubes, VIPs y TICs que han llegado a bodega</li>
      <li>Usar el botón "Agregar Items" para seleccionar y confirmar la devolución</li>
    </ol>
  </div>

  <!-- Items Pendientes -->
  <div class="rounded-xl border border-warning/40 bg-warning/5 mb-8" id="dev-pend-wrapper">
    <div class="flex items-center justify-between px-5 pt-4 pb-2 flex-wrap gap-3">
      <div>
        <div class="font-semibold text-lg flex items-center gap-2">Items Pendientes de Devolución <span id="dev-spin" class="loading loading-spinner loading-xs hidden"></span></div>
        <div id="dev-pend-count" class="text-sm opacity-70">(0 items listos para devolver)</div>
      </div>
      <button id="dev-btn-add" class="btn btn-primary btn-sm gap-2" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor"><path d="M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6Z"/></svg>
        Agregar Items
      </button>
    </div>
    <div class="px-5 pb-5">
      <div id="dev-empty" class="py-12 text-center text-sm opacity-60">
        No hay items pendientes de devolución
      </div>
  <!-- Contenedor de la lista; clases de grid se agregan dinámicamente via JS -->
  <div id="dev-pend-list" class="hidden"></div>
    </div>
  </div>

  <!-- Resumen de devueltos -->
  <div class="rounded-xl border border-success/30 bg-success/5" id="dev-resumen">
    <div class="px-5 py-3 flex items-center justify-between gap-3 flex-wrap border-b border-success/20">
      <div class="flex items-center gap-2 font-semibold">Items Devueltos <span id="dev-total" class="badge badge-success badge-sm">0</span></div>
      <div class="text-xs opacity-60" id="dev-last-update"></div>
    </div>
    <div class="p-5 grid md:grid-cols-3 gap-5">
      <div class="rounded-lg p-6 bg-base-200/60 flex flex-col items-center text-center">
        <div class="text-3xl mb-1" id="dev-count-cubes">0</div>
        <div class="text-xs uppercase tracking-wide opacity-70">Cubes</div>
      </div>
      <div class="rounded-lg p-6 bg-base-200/60 flex flex-col items-center text-center">
        <div class="text-3xl mb-1" id="dev-count-vips">0</div>
        <div class="text-xs uppercase tracking-wide opacity-70">VIPs</div>
      </div>
      <div class="rounded-lg p-6 bg-base-200/60 flex flex-col items-center text-center">
        <div class="text-3xl mb-1" id="dev-count-tics">0</div>
        <div class="text-xs uppercase tracking-wide opacity-70">TICs</div>
      </div>
    </div>
  </div>
</div>

<!-- Modal selección devolución -->
<dialog id="dev-modal" class="modal">
  <div class="modal-box w-full max-w-2xl md:max-w-3xl">
    <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button></form>
    <h3 class="font-bold text-lg mb-2">Confirmar Devolución</h3>
  <p class="text-xs opacity-70 mb-4">Escanea o pega RFIDs. Solo se validan items en Operación con sub-estado Transito.</p>
    <div class="space-y-3">
      <div>
        <label class="text-[11px] font-medium uppercase opacity-60 block mb-1">RFIDs</label>
        <textarea id="dev-input" class="textarea textarea-bordered w-full h-28 text-xs font-mono resize-y" placeholder="Escanear o pegar (uno por línea o separados por espacios)"></textarea>
      </div>
      <div id="dev-validate-msg" class="text-xs"></div>
      <div class="grid gap-2 sm:grid-cols-2 md:grid-cols-3" id="dev-selected"></div>
      <div class="flex flex-wrap gap-3 justify-end pt-2 border-t border-base-200">
        <button type="button" id="dev-clear" class="btn btn-ghost btn-sm">Limpiar</button>
        <button type="button" id="dev-validate" class="btn btn-outline btn-sm">Validar</button>
        <button type="button" id="dev-confirm" class="btn btn-primary btn-sm" disabled>Confirmar Devolución</button>
      </div>
    </div>
  </div>
</dialog>

<script src="/static/js/devolucion.js?v=<%= assetVersion %>" defer></script>

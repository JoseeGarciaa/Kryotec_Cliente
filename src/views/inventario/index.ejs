<% title = 'Inventario' %>

<div class="mb-2">
  <p class="text-sm opacity-70">Gestión de credocubes y componentes RFID</p>
  <form method="get" action="/inventario" class="mt-2">
    <div class="form-control">
      <label class="input input-bordered flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
        <input type="search" class="grow" placeholder="Buscar por nombre, RFID, lote o estado..." name="q" value="<%= q || '' %>" maxlength="24" />
      </label>
    </div>
    <div class="text-xs opacity-60 mt-1">0/24 caracteres</div>
    <div class="mt-3 flex flex-wrap gap-2">
      <a class="btn btn-sm <%= !cat ? 'btn-primary' : '' %>" href="/inventario<%= q ? ('?q='+encodeURIComponent(q)) : '' %>">Todos (<%= counts?.total || 0 %>)</a>
      <a class="btn btn-sm <%= cat==='cubes' ? 'btn-primary' : '' %>" href="/inventario?cat=cubes<%= q ? ('&q='+encodeURIComponent(q)) : '' %>">Cubes (<%= counts?.cubes || 0 %>)</a>
      <a class="btn btn-sm <%= cat==='vips' ? 'btn-primary' : '' %>" href="/inventario?cat=vips<%= q ? ('&q='+encodeURIComponent(q)) : '' %>">VIPs (<%= counts?.vips || 0 %>)</a>
      <a class="btn btn-sm <%= cat==='tics' ? 'btn-primary' : '' %>" href="/inventario?cat=tics<%= q ? ('&q='+encodeURIComponent(q)) : '' %>">TICs (<%= counts?.tics || 0 %>)</a>
    </div>
  </form>
</div>

<div class="card bg-base-200 shadow-lg transition-all hover:shadow-xl">
  <div class="card-body animate-slide-up">
    <div class="overflow-x-auto">
      <table class="table table-zebra">
        <thead>
          <tr>
            <th>NOMBRE UNIDAD</th>
            <th>MODELO ID</th>
            <th>RFID</th>
            <th>LOTE</th>
            <th>ESTADO</th>
            <th>SUB-ESTADO</th>
            <th>CATEGORÍA</th>
            <th>ÚLTIMA ACTUALIZACIÓN</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(i => { %>
            <tr>
              <td><%= i.nombre_unidad %></td>
              <td><%= i.modelo_id %></td>
              <td><%= i.rfid %></td>
              <td class="whitespace-nowrap"><%= i.lote || '' %></td>
              <td class="whitespace-nowrap"><div class="badge badge-primary badge-outline hover:badge-secondary transition-colors whitespace-nowrap"><%= i.estado %></div></td>
              <td class="whitespace-nowrap"><% if (i.sub_estado) { %><div class="badge badge-outline whitespace-nowrap"><%= i.sub_estado %></div><% } else { %><span class="opacity-60">—</span><% } %></td>
              <td><%= i.categoria %></td>
              <td><%= new Date(i.ultima_actualizacion).toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>
